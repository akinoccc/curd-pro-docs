import{c as J,d as E,a as K,u as L,n as O,b as Q,_ as W,e as X,f as Y,g as Z,C as h,h as ee,i as te,j as se}from"./memory-crud-HprK2rmi.js";import{f as B,d as F,g as D,h as re,c as ae,a as s,w as o,u as t,b as l,N as m,i as oe,j as N,B as V,t as _,k as A,l as I,o as le}from"./index-C_iRN830.js";import{N as ne,c as ie,b as j,a as de}from"./mock-dicts-DaoPAJwu.js";import{u as $}from"./use-message-B2KrddAV.js";function ue(){const y=B([]);function M(u){y.value=y.value.concat(u)}function p(u){const g=y.value;return(u?g.filter(i=>i.area===u):g).slice().sort((i,b)=>{const v=i.order??0,R=b.order??0;return v-R})}return{actions:y,register:M,list:p}}const ce={style:{display:"flex","flex-direction":"column",gap:"12px"}},fe={style:{display:"flex","align-items":"center","justify-content":"space-between",gap:"12px"}},me={style:{"margin-top":"12px"}},pe={style:{"margin-top":"12px"}},be={style:{margin:"0",padding:"8px",background:"rgba(0,0,0,0.04)","border-radius":"6px"}},we=F({__name:"manual-compose-page",setup(y){const M=ie(),p=J(E(89)),u=Q(),g=K(u),k=$(),i=L({adapter:p.adapter,debounceMs:150,dedupe:!0,onError(n){console.error(n)}}),b=B(!1),v=B(null),R=D(()=>v.value?"edit":"create");function P(){v.value=null,b.value=!0}function U(n){v.value=n,b.value=!0}const T=ue();function z(n){T.register(n)}z({id:"refresh",area:"toolbar",label:"刷新",order:10,onClick:async()=>{await i.refresh()}}),z({id:"reset-data",area:"toolbar",label:"重置数据",order:20,onClick:async()=>{p.reset(E(89)),await i.refresh()}}),z({id:"batch-delete",area:"batch",label:"批量删除选中",order:10,disabled:n=>n.selectedRows.length===0,onClick:async n=>{var a,d;const e=n.selectedRows.map(c=>c.id);for(const c of e)await((d=(a=p.adapter).remove)==null?void 0:d.call(a,c));await i.refresh()}});const q=F({name:"ActionBar",props:{area:{type:String,required:!0}},setup(n){const e=$(),a=A(te,null),d=A(se,null),c=A(h,D(()=>[])),f=A(ee,B(new Set)),C=D(()=>a?Array.isArray(a)?a.filter(r=>r.area===n.area).slice().sort((r,x)=>(r.order??0)-(x.order??0)):a.list(n.area):[]);function w(){var r;return{selectedRows:c.value,query:((r=d==null?void 0:d.query)==null?void 0:r.value)??{},extra:{selectedIds:Array.from(f.value)}}}function H(r){const x=w();r.visible&&!r.visible(x)||r.disabled&&r.disabled(x)||Promise.resolve(r.onClick(x)).catch(S=>{e.error(String((S==null?void 0:S.message)??S))})}return()=>C.value.length===0?null:I(j,{size:8,align:"center"},{default:()=>C.value.map(r=>I(V,{size:"small",type:r.type,disabled:r.disabled?r.disabled(w()):!1,onClick:()=>H(r)},{default:()=>r.label??r.id}))})}});async function G(n){var e,a,d,c;try{const{mode:f,data:C}=n;if(f==="create")await((a=(e=p.adapter).create)==null?void 0:a.call(e,C));else{const w=v.value;if(!w){k.error("未选择要编辑的行");return}await((c=(d=p.adapter).update)==null?void 0:c.call(d,w.id,C))}await i.refresh(),b.value=!1,k.success("保存成功")}catch(f){k.error(String((f==null?void 0:f.message)??f))}}return re(()=>{i.refresh()}),(n,e)=>(le(),ae("div",ce,[s(t(ne),{type:"info",bordered:!1},{default:o(()=>[e[7]||(e[7]=l(" 这个页面不使用 ",-1)),s(t(m),{code:""},{default:o(()=>[...e[1]||(e[1]=[l(" NaiveAutoCrud ",-1)])]),_:1}),e[8]||(e[8]=l("，而是手动组合 ",-1)),s(t(m),{code:""},{default:o(()=>[...e[2]||(e[2]=[l(" useCrud ",-1)])]),_:1}),e[9]||(e[9]=l(" + ",-1)),s(t(m),{code:""},{default:o(()=>[...e[3]||(e[3]=[l(" CrudProvider ",-1)])]),_:1}),e[10]||(e[10]=l(" + ",-1)),s(t(m),{code:""},{default:o(()=>[...e[4]||(e[4]=[l(" NaiveCrudSearch/Table/Form ",-1)])]),_:1}),e[11]||(e[11]=l("，并演示 ",-1)),s(t(m),{code:""},{default:o(()=>[...e[5]||(e[5]=[l(" useCrudActions ",-1)])]),_:1}),e[12]||(e[12]=l(" 与 ",-1)),s(t(m),{code:""},{default:o(()=>[...e[6]||(e[6]=[l(" NaiveCrudForm ",-1)])]),_:1}),e[13]||(e[13]=l(" 的表单校验（由 UI 层规则驱动）。 ",-1))]),_:1}),s(t(W),{crud:t(i),fields:t(u),columns:t(g),actions:t(T),user:{roles:["admin"]},extra:{from:"manual-page"},"control-map":t(O),"dict-api":t(M),"get-id":a=>a.id},{default:o(()=>[s(t(oe),null,{default:o(()=>[N("section",fe,[s(t(j),{size:8,align:"center"},{default:o(()=>[s(t(V),{type:"primary",onClick:P},{default:o(()=>[...e[14]||(e[14]=[l(" 新增 ",-1)])]),_:1}),s(t(q),{area:"toolbar"}),s(t(de),{vertical:""}),s(t(q),{area:"batch"})]),_:1}),s(t(m),{depth:"3",style:{"font-size":"12px"}},{default:o(()=>[l(" 当前模式："+_(R.value)+"，列表共 "+_(t(i).total.value)+" 条 ",1)]),_:1})]),N("section",me,[s(t(X))]),N("section",pe,[s(t(Y),{columns:t(g),"show-selection":!0,"show-actions-column":!0},{"row-actions":o(({row:a})=>[s(t(j),{size:8,justify:"center"},{default:o(()=>[s(t(V),{size:"small",tertiary:"",onClick:d=>U(a)},{default:o(()=>[...e[15]||(e[15]=[l(" 编辑 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:1},8,["columns"])]),s(t(Z),{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),row:v.value,fields:t(u),"form-mode":"modal","reset-on-close":"",onSubmit:G},{"field-remark":o(({model:a})=>[s(t(m),{depth:"3",style:{display:"block","margin-bottom":"8px"}},{default:o(()=>[...e[16]||(e[16]=[l(" 这里是自定义 field slot（并且该字段仅当 status=disabled 时可见） ",-1)])]),_:1}),N("pre",be,_(a.remark),1)]),_:1},8,["modelValue","row","fields"])]),_:1})]),_:1},8,["crud","fields","columns","actions","control-map","dict-api","get-id"])]))}});export{we as default};
